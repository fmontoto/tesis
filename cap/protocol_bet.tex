\subsection{Second part: The bet}

\subsubsection{Bet Promise}
Once players decided the oracles to use, whether using the \textit{Oracle
  Selection} part or by any other mean.
They need to agree in the terms of the bet, the event and who is the winner on
  each outcome, the time available for the oracles to answer, money required by
  each player, fees of the  oracles, deposit required to the oracles, etc..
Once all the bet parameters are set, they are serialized and its hash is
  calculated, players puts all the money required to run the protocol,
  including fees and the prize into a transaction.
The selected oracles, bet hash and a method\footnote{For instance an URL to a
  website with the bet description. Oracles are responsible to check the
  description fetched with the hash provided in the transaction.} to get the
  transaction full description are appended to this transaction in plain text
  and the transaction is sent to the blockchain.
We call this transaction ``\textit{Bet Promise}'', as it is a commitment from both
  players to the bet:

\transaction
    {Bet Promise}{A previous tx, B previous tx}
    {A previous tx}{$\alpha_A$}{$\sigma_A$}
    {B previous tx}{$\alpha_B$}{$\sigma_B$}
    \stopinputs
    {0}{\footnotesize{OP\_RETURN \{Bet Channel, Oracle List, Bet hash\}}}
    {$\mathcal{P} - \fee{Bet Promise} / 2$}{(\signature{A} $\wedge$ \signature{B}) \\
                                                   \vee \\
                                                  (\timeout{bet} $\wedge$ \signature{A}) }
    {$\mathcal{P} - \fee{Bet Promise} / 2$}{(\signature{A} $\wedge$ \signature{B}) \\
                                                   \vee \\
                                                  (\timeout{bet} $\wedge$ \signature{B}) }
    {$c/n$}{(\signature{A} $\wedge$ \signature{B})}
    {...}{... \guilsinglleft n - 2\guilsinglright ...}
    {$c/n$}{(\signature{A} $\wedge$ \signature{B})}
    \stopoutputs
    {tx:bet_promise}
    {Bet Promise}

The inputs for this transaction are not relevant to the protocol, they spend
  money from both player to pay for this bet.
There can be more than one input by player, and change outputs if required.
As it's unlikely the players have an unspent transaction for the exact amount
  required for the bet.
To simplificate the transaction, more inputs nor change outputs are included.

The first output does not transfer any money, but includes: the list of oracles
  asked to participate; the channel to use for retrieving the full bet and the
  hash to compare the retrieved bet against.
When an oracle sees itself in the list of oracles, it goes to the channel and
  retrieves the bet, compares it against the expected hash.
Read the description and decides to participate or not.

The second and third outputs of this transaction moves most of the money into
  a joined account, so from now on it can only be moved by both players
  together.
This represents the commitment to start the bet, as each one lock its own money
  under the other's will.
In the case one of the players disappear, after \timeout{bet} the money can
  recovered by its owner.

The outputs 3 to 3 + (n - 1) are a small portion of the money, used for the
  oracle inscriptions.
This money does not includes a timeout because it is an small amount, if players
  are willing to pay the extra fee required to add this timeout, it can be
  added.

This transaction spends $\mathcal{P} + \frac{c}{2}}$ from each player:
  $ n \cdot \frac{c}{n}$ goes to pay for oracle inscriptions; \fee{Bet Promise}
  goes to pay this transaction's fees; and
  $2 \cdot \matchcal{P} - \fee{Bet Promise} $ for paying the bet and its
  associated costs.

\subsubsection{Oracle Inscription}
Oracles invited to participate needs to retrieve the Bet description as
  instructed in the \textit{Bet Promise} transaction and decide whether to
  participate or not.
When one or more oracles do not participate, players decide how to select a new
  one, a waiting list is recommended to be selected in the first part of the
  protocol.
When a oracle decides to participate, it builds and sends to the players its
  incription transaction, spending money from the \textit{Bet Promise}
  transaction:

\transaction
    {Oracle Inscription}{Oracle previous tx, Bet Promise}
    {Oracle previous tx}{$\alpha$}{$\sigma$}
    {Bet Promise}{3 + Oracle Index}{\signature{A} $\wedge$ \signature{B}}
    \stopinputs
    {[Registration] + c/n + [Oracle Payment] \\ - \fee{Oracle Inscription}}
        {(\signature{Oracle} $\wedge$ \signature{A} $\wedge$ \signature{B}) \\
            $\vee$ \\
         (\signature{Oracle} $\wedge$ \timeout{Bet}}
    {[Two Answers Penalty]}{((\signature{A} $\vee$ \signature{B}) $\wedge$ %
                             ($AWins_o \wedge BWins_o$)) \\
                           $\vee$ \\
                       (\signature{Oracle} $\wedge$ \timeout{two})}
    \stopoutputs
    {tx:oracle_inscription}
    {Oracle Inscription}

This transaction is the oracle's commitment with the bet and the players
  acceptance of it as oracle.
The oracle sends [Registration] + [Oracle Payment] as initial payment
  (input [0]), and players c/n from the \textit{Bet Promise} (input 1).

The first output takes the money under the oracle and both players control, to
  be used in the \textit{Bet} transaction.
And the second one is a penalty to be charge if the oracle misbehaves.
If the oracle reveals that player A and player B wins, this money can be taken
  by any player. Otherwise the money can be claimed back by the oracle after
  \timeout{two}.
At this output the hash of the answers is revealed ($H(AWins_o), H(BWins_o)$),
  the oracle must keeps$AWins_o$ and $BWins_o$ secret, revealing this value is
  equivalent to choose a winner.

\subsubsection{Bet}

Once the required oracles are inscribed to participate the ``Bet'' transaction
  is built by the players.
 The input contains what is remaining from the original players contributions to
   the prize, controlled by the players' joint account plus most\footnote{The
  other portion of this deposit was used in the \textit{two answers penalty}
  output in the \textit{Oracle Inscription} transaction.} of the oracles
  deposit, controlled by the corresponding oracle and both players.
Because of this, the transaction must be signed by both players and all the
  oracles:

\transaction
    {Bet}{Bet Promise, Oracles Inscription}
    {Bet Promise}{0}{\signature{A} $\wedge$ \signature{B}}
    {Bet Promise}{1}{\signature{A} $\wedge$ \signature{B}}
    {Oracle Inscription}{0}
    {\signature{A} $\wedge$ \signature{B} $\wedge$ \signature{O}\tikzmark{ini:a}}
            {...}{..}{...}
    \stopinputs
    {$\mathcal{P} + n/2 \cdot $($[Registration] \\
    - [Oracle Payment] \\
    - \fee{Oracle Inscription}$)$ \\
    - 1/2 $($\fee{Bet Promise} + \fee{Bet}$)}
    {(\signature{A} $\wedge$ \signature{B}) \\
                                                   \vee \\
                                                  (\timeout{bet} $\wedge$ \signature{B}) }
    {[Oracle Payment]}{(\signature{o} $\wedge$ ($AWins_o \vee BWins_o$) %
                       $\wedge$ \timeout{Bet}) \\
                       $\vee$ \tikzmark{ini:b} \\
                       \signature{A} $\wedge$ \signature{B} $\wedge$ %
                       \timeout{Reply}}
    {...}{...}
    {[Oracle Payment]}{($AWins_o$ $\wedge$ ($BWins_{\hat{o}} \wedge %
                        \tikzmark{ini:c}...$) $\wedge$ \signature{B}) \\
                       $\vee$ \\
                       ($BWins_o$ $\wedge$ $($AWins_{\hat{o}}$ %
                        \wedge \tikzmark{ini:d} ...$) $\wedge$ \signature{A}) \\
                       $\vee$ \\
                        \signature{o} $\wedge$ \timeout{undue}\tikzmark{ini:e}}
    {...}{...}
    \stopoutputs
    {tx:bet}
    {Bet}

\raisebox{17em}[0pt][0pt]{
        \hbox{\hspace{34em} \framebox[1.1\width]{\tikzmark{end:a}$\forall o \in $ Oracles}}
}
\raisebox{12em}[0pt][0pt]{
    \hbox{\hspace{35em}{\framebox[1\width]{
            \parbox{80\unitlength}{\tikzmark{end:c}For at least $m\\\hat{o} \in $ Oracles}}}}
}
\raisebox{8em}[0pt][0pt]{
        \hbox{\hspace{35em} \framebox[1.1\width]{\tikzmark{end:d}$\forall o \in $ Oracles}}
}
\begin{tikzpicture}[overlay, remember picture, yshift=.25\baselineskip,%
                    shorten >=.5pt, shorten <=.5pt]
    \draw [->] ([bend left,xshift=17mm]{pic cs:ini:a}) [bend left, yshift=3mm, xshift=1mm] %
                to ({pic cs:end:a});
    \draw [->] ([bend right,xshift=22mm]{pic cs:ini:b}) [bend right, yshift=-3mm, xshift=1mm] %
                to ({pic cs:end:a});
    \draw [->] ([bend right,xshift=1mm, yshift=-2mm]{pic cs:ini:c}) [bend right, yshift=0mm, xshift=-2mm] %
                to ({pic cs:end:c});
    \draw [->] ([xshift=1mm, yshift=3mm]{pic cs:ini:d}) [yshift=-4mm, xshift=-2mm] %
                to ({pic cs:end:c});
    \draw [->] ([bend left,xshift=6mm, yshift=2mm]{pic cs:ini:e}) [bend left, yshift=0mm, xshift=-2mm] %
                to ({pic cs:end:d});
\end{tikzpicture}

The first two outputs are the prize, divided in two, so in case there is no
  answer from the oracles half of the prize returns to each player.
Each of them getting back almost all the money initially spend, some is lose
  on fees and oracle payments. \colorbox{red}{Esto depende de los valores de
  las variables}. On the other hand, if the oracles get to an agreement and the
  bet is resolved on time. Using the oracles' answer the winner player can spend
  both outputs.

The next $n$ outputs are the oracle payments, they are spendable by the
  corresponding oracle plus any of its answers.
Spending this output requires to make public the oracle's answer. This way the
  oracle is guaranteed to get its payment when responding on time, and players
  know the oracle only gets pay when it answers.
  If the transaction is not spent in a defined time (T$_{\text{reply}}$) we say
  the oracle didn't answer and the money can be spend by the players joint
  account.
This prevents the oracle of taking the money after not responding in the
  required time.

The last $n$ outputs are a withholding for the same amount of the oracle
  payment, if the oracle gives a wrong answer for the oucome this money
  goes to the real winner, this way we take the payment out from the oracle.
If it behaves as expected, the oracle can spend this money some time after
  (T$_{\text{undue}}$) the bet is resolved.

After this transaction is placed, every player only wait for the events to take
  place and spend, if they can the outputs availables. The only transaction
  remaining are the participants taking the money they are entitled to.



The payment of the oracle's is not the only cost of this protocol.
There is a not insignificant number of transactions in the protocol, as there
  is a fee by each transaction in the Blockchain, this makes the protocol more
  expensive.
This is a problem for small bets, the presented protocols is prohibitively
  expensive for bet of just a few dollars. At least with the current fee costs
  of bitcoin.

If we step out a little bit, the proposed protocol uses paid oracles to get a
  binary answer about an event outside the blockchain. This is not useful only
  for betting on that outcome. The oracles are \footnote{\colorbox{red}{
  is this the word?}} insensitive to the use given to their answer, they get
  paid anyway. Further applications of the protocol can be generalized from our
  proposal.
Resolution of contractual disputes is an interesting topic, where parties agree
  to use arbitrator(s) to decide a missunderstanding.
In this case oracles takes part in the protocol more like judge than a oracle.
