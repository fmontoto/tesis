\section{Gambling} \label{gambling}
Gambling is the activity of predicting events and placing a wager on the
  uncertain outcome of those events, with the intent of winning money or
  valuable goods.
A wager can be placed on many different events. In a casino we find randomizing
  devices as dice, roulette wheels, etc.\ which are used to get randomized
  events. In other establishments we can bet on sporting events, such as a horse
  racing, football games,  or even the minimum temperature in Santiago during a
  particular night.
Given the gambling popularity and the large amounts of money at stake inevitably
  entails a lot of interest in such activities.
Sometimes gambling is heavily regulated and taxed, and lotteries are usually
  owned by the state.

Internet has made it cheaper to open and operate a casino, without the need of
  complying with laws of a particular country.
This and the massive internet grow has moved a big percentage of the gambling
  industry online \cite{shelat2002makes,griffiths2008internet}.
The global Internet gambling market was estimated to be worth US\$28 billion in
  2012 and forecasted to rise to US\$49 billion by 2017%
  \cite{gainsbury2015risky}.
However, gambling not only takes place in casinos, lotteries or betting sites,
  it can also involve two or more individuals with no intermediaries.
In Chile, friends usually bet on their favorite football teams.

Of all the different ways for placing a bet, the aforementioned share a common
  obstacle: participants are required to trust in the other parties to pay if
  they lose.
Even if the bet takes place in a physical casino, where the law can enforce
  the bet, it is not certain the casino will be able to pay after the
  resolution.
We might not be aware of the fact, but every time we place a bet we are
  implicitly trusting in a third party, either the other player or the bet
  site. For physical casinos this is usually not a problem, as they are
  regulated by the law, any misconduct can get the casino in legal problems
  resulting in a revoked license to operate.
As there is a significant cost involved in starting a physical casino,
  maintaining a good reputation will attract customers.

Friends usually are trusted people, so trusting them when gambling might not
  be considered an issue, but the friendship could be put at risk if the bet
  is not paid. Another option is to place the bet with the help  of a third
  friend, who holds the money and pass it to the winner when the bet is
  resolved.
Online casinos on the other hand are more problematic as there are many known
  scam schemes, as described by Griffiths \cite{griffiths2010crime}. And
  half of the players at these sites believe the providers are cheating on
  them \cite{mcmullan2010online}. However, some of them are subject to
  government regulation and many have been in the business for several years.
This kind of characteristics can help to identify a trustworthy online site.

But, what if you would like to gamble in a event that no gambling site offers
  nor any friend is willing to do gamble in it? Likely the internet would be the
  place to look for somebody willing to gamble on this event. Yet, how could you
  trust the potential person in order to bet with him/her?

\section{Cryptocurrency}
Digital currency refers to any currency stored and transferred
  electronically.
A subset of the digital currencies is called virtual currencies: they are
  usually defined \cite{bcentraleuro} as a \itquote{unregulated,
  digital money, which is issued and usually controlled by its developers, and
  used and accepted among the members of a specific virtual community}.

Based on the interaction of the currency with currencies outside the
  community there are three types of virtual currencies: the ones with almost
  no interaction with the outside money, this is usually the case of video
  games, where its currency is only valuable within the game. A second
  type is where the currency can be purchased directly using other currency.
  Here, we observe an unidirectional flow. The third type is when the flow is
  bi-directional, the users can sell and buy the currency.
A cryptocurrency is a bi-directional virtual currency that uses cryptography
  for security and anti-counterfeiting measures. Virtual currencies are being
  historically linked to cryptography. The first known investigations
  \cite{chaum1983blind} to establish a virtual currency were lead by David
  Chaum, an American cryptographer. However, despite his and others' effort
  (e-gold\footnote{https://www.wired.com/2009/06/e-gold/},
  Ecash \cite{chaum1990untraceable},
  DigiCash, LibertyReserve, among others), virtual currencies never were
  massively adopted.

By late 2008, a short whitepaper \cite{nakamoto2008bitcoin} signed using a
  pseudonym, was released with yet another virtual currency protocol
  specification. Later in 2009 its implementation was made available as open
  source code. The main difference with previous implementations was its lack of
  a central organization. This new coin was completely decentralized.
The software started to be run by some early enthusiasts and Bitcoin went from
  an idea to a usable coin.
In the beginning the coins were exchanged for free among the community users.
However, at some point the community was big enough and its members started
  to give value to the coin, then the first exchanges from and to other coins
  started to take place. Bitcoin transitioned into a bi-directional flow
  virtual coin.

Then the first online exchanges between bitcoin and other currencies started
  to appear, and the coin started to gain popularity as people outside the
  community were able to buy and sell coins.
As the money became popular, the idea was taken and a whole generation of
  cryptocurrencies was born.
Today the market capitalization of Bitcoin (this is, the amount of money times
  its value in USD) is over 25,000,000,000 USD.

\section{Gambling using cryptocurrencies}

With cryptocurrencies getting more popular, it was only a matter of time until
  the first sites started to offer some games of chance, acting as online
  casinos.
The only difference of these new sites with a traditional online casino was the
  currency on which the bet takes place.
However, as any other currency online casino, any player who decided to play
  here is at the mercy of the casino.
If the casino does not want or does not have the means to pay, there is nothing
  the participant can do, and his money is lost.
The problems described for online casinos using traditional currencies apply in
the same way to the new ones.
(More on online casinos in Section~\ref{gambling}.)

After some time, people started to see potential of cryptocurrencies at solving
  some of the trust issues related to gambling.
In 2014 Andrychowicz et al. \citation{andrychowicz2014secure} proposed a
  two-party randomized gambling protocol.
Players are not required to trust each other in order to gamble, so even if the
  loser does not behave correctly, the honest player receives the prize.
The protocol is not a representation of a casino game, but effectively allows
  players to gamble on a random event.
Also in 2014, a group of Bitcoin enthusiasts started
  Orisi\footnote{http://orisi.org}, a distributed oracles system for
  cryptocurrency contracts.
Orisi allows users to access data from the outside world from the blockchain
  by using a distributed set of oracles. So instead of trusting in one instance
  to provide the data, the trust is placed in the majority of several different
  oracles.
More recently, in early 2017, Winsome\footnote{https://www.winsome.io} was
  released. Advertised as a \itquote{Provably Fair | Trustless Casino}, Winsome
  is an online casino where wagers are placed in a public smart contract posted
  in the Ethereum's blockchain.
The contract defining the game is enforced by the Ethereum protocol.
As of May 2017, they do offer two casino games, blackjack and \texttt{Rouleth},
  which is an online roulette.

Motivated to provide an option to gamble over real world events with untrusted
 peers,
this work proposes a protocol to define the destination of an initial wage
  between the two players.
The decision is made by a set of oracles, which are being paid also within the
  protocol to behave correctly.

\section{Objectives}
Design and implement a distributed protocol where real world observations can
  be used as blockchain transaction inputs.

\subsection{Specific objectives}
\begin{enumerate}
	\item Provide a protocol to make it possible to gamble with untrusted peers
	  about real world events.
	\item Provide the correct economic incentives to the protocol participants to
	  behave correctly.
	\item Implement a proof of concept of the designed protocol.
	\item Discuss implications and other applications of the protocol.
\end{enumerate}

\section{Methodology}
The main phases of this work will be the following:
\begin{enumerate}
	\item Extensive review of existing proposal and implementations to solve
	  the proposed problem or similar ones. As cryptocurrencies are a recent
	  research field, this review must cover literature as well as
	  community gathering places, such as forums and specialized blogs,
	  magazines, etc.
  \item Analysis of current solutions to the problem and similar ones.
  \item Design and implementation of a protocol to solve the problem.
    Implementation is considered very important as the current rate of change
    of cryptocurrencies is considerably fast, and validating the protocol within
    a real implementation is critical.
  \item Analysis of the economic incentives of the protocol participants, to
    ensure protocol viability.
\end{enumerate}

\section{The proposed protocol}

The main idea behind this work is to eliminate most single points of
  trust when performing bets.
Traditional currencies are produced and controlled by governments, so the first
  decision was to use a currency without a single controller.
We chose Bitcoin mainly for two reasons.
It is the first and one of the most stable currencies out there.
Changes are made much slower than other currencies, the market backs this claim
  by making bitcoin the Cryptocurrency with by far the biggest market
  capitalization.
And second, the network supporting bitcoin is much bigger than the ones for
  other cryptocurrencies. This makes it much harder to attack and take control
  of the currency.

Our proposed protocol lets users bet against each other over the outcome of
  future events, without trusting each other nor any individual judge.
It keeps the money under each player's control and relies on a distributed set
  of oracles to decide who wins the money.

There are two main phases in the protocol: oracle selection and bet
  resolution. They are explained as follows:

\subsection{Oracle Selection}
In this first step the players compile a list of oracles from a distributed
  and public source, and select randomly from there a subset of oracles to
  be used in their bet.

Bitcoin (like most of the cryptocurrencies) includes a scripting language
  (see Appendix~\ref{sec:appendix_script})
able
 to control money transferences, well defined and with its execution enforced by
 the complete bitcoin network.
The challenge is to bring data from outside the bitcoin blockchain into it so
  scripts on it can run on that data.
Our protocol relies on several paid \textit{oracles} to bring this data.
As the oracles' output will be used to decide who is the bet's winner, it is a
  crucial step.
The chances of a player tampering the list with oracles controlled by him must
  be minimized.
We say this phase is optional as it might be the case both players trust already
  in a set of oracles.

\subsection{Bet Resolution}
This phase starts after the players agree on the bet and the oracles to be used
  on it.
Both players build and sign a transaction containing all the Bitcoins required
  for the bet, the bet description and the list of oracles chosen to
  participate.
This transaction is sent to the blockchain to make it publicly visible. So
  oracles know they are asked to participate.
Oracles express their desire to participate by submitting an enrollment
  transaction into the blockchain.
If enough oracles enroll, the bet can take place.

Once the required number of oracles are enrolled to participate, the Bet
  transaction is placed in the blockchain, and signed by the oracles
  participating and both players.
All the payments are also set in this transaction: the payments for the winner
  player; the payments for the oracles that answer properly; and the payments
  to the players from the oracles that do not behave properly.

Oracles get their payment by answering who the winner is, and as soon as
  enough oracles vote for one player as the winner\footnote{Enough is a
  threshold defined in the bet parameters, at least$\lfloor \frac{n}{2}
  \rfloor + 1$ with $n$ the number of oracles. This ensures there is only
  one winner, any number below this threshold can lead to two winners
  in a correct execution of the protocol.}, the winning  player can take
  its reward.
